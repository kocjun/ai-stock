# AI 기반 대장주 자동 선정 시스템

거래량 중심의 AI 분석으로 업종별 대장주를 동적으로 선정하는 완전 자동화 시스템

**버전**: 1.0
**작성일**: 2025-10-25
**상태**: ✅ 구현 완료

---

## 📋 목차

1. [시스템 개요](#시스템-개요)
2. [핵심 특징](#핵심-특징)
3. [아키텍처](#아키텍처)
4. [사용 방법](#사용-방법)
5. [분석 알고리즘](#분석-알고리즘)
6. [실행 예시](#실행-예시)
7. [설정 및 커스터마이징](#설정-및-커스터마이징)
8. [FAQ](#faq)

---

## 시스템 개요

### 문제 인식

기존 업종별 대장주 전략의 한계:
- ❌ **하드코딩된 종목 리스트**: 시장 변화에 적응 못함
- ❌ **수동 선정**: 주관적 판단에 의존
- ❌ **거래량 미고려**: 유동성 리스크 존재
- ❌ **정적 분석**: 실시간 시장 상황 반영 안됨

### 솔루션

AI 기반 동적 대장주 선정:
- ✅ **완전 자동화**: 수동 개입 없이 실시간 분석
- ✅ **거래량 중심**: 유동성을 최우선 지표로 평가
- ✅ **다차원 분석**: 거래량 + 재무 + 기술 + 리스크
- ✅ **블랙리스트 통합**: 문제 종목 자동 필터링
- ✅ **시장 적응형**: 시장 상황에 따라 선정 변경

### 투자 철학

> "거래량은 시장의 진실을 말한다"

사람들이 많이 사는 주식(높은 거래량)은:
- 시장의 관심과 자금이 집중
- 가격 변동 시 빠른 대응 가능
- 매수/매도 타이밍 유리
- 상승 모멘텀 지속 가능성 높음

---

## 핵심 특징

### 1. 거래량 중심 분석 (30% 가중치)

**평균 거래대금 (20일/60일)**
- 2,000억원 이상: 50점 (최상)
- 1,000억원 이상: 45점
- 500억원 이상: 40점
- 최소 기준: 500억원 (미달 시 제외)

**거래량 추세 분석**
- 급증 (+50% 이상): 30점 + 보너스
- 증가 (+20% 이상): 25점
- 유지 (±20%): 20점
- 감소: 15점

**변동성 평가 (변동계수)**
- 안정적 (CV < 0.3): 10점
- 보통 (CV < 0.5): 7점
- 불안정 (CV ≥ 0.5): 5점

### 2. 다차원 종합 평가

```
총점 = 거래량(30%) + 재무(30%) + 기술(20%) + 리스크(20%)
```

| 평가 요소 | 가중치 | 주요 지표 |
|----------|--------|----------|
| **거래량/유동성** | 30% | 평균 거래대금, 추세, 안정성 |
| **재무 건전성** | 30% | ROE, 부채비율, 영업이익률 |
| **기술적 분석** | 20% | 모멘텀, 추세, 지지/저항 |
| **리스크 관리** | 20% | 변동성, MDD, Sharpe Ratio |

### 3. 5대 업종 자동 분류

**업종별 키워드 매칭**

```python
반도체/전기전자: 반도체, 전자, 디스플레이, 전기전자
자동차/운수장비: 자동차, 자동차부품, 운수장비, 조선
화학: 화학, 정유, 플라스틱, 타이어
금융: 은행, 증권, 보험, 금융
IT/인터넷: 인터넷, 게임, 소프트웨어, IT서비스, 통신서비스
```

**동적 분류**:
- 데이터베이스 `sector` 필드 기반
- 키워드 포함 여부로 자동 매칭
- 업종 미분류 종목은 "기타"로 처리

### 4. 블랙리스트 자동 통합

**제외 종목 관리**:
- 사용자 지정 블랙리스트 자동 필터링
- 제외 사유 및 메모 기록
- 로그에 명시적 표시

**예시**:
```
⚠️  카카오 (035720): 블랙리스트 제외
  사유: 높은 변동성
  메모: 단기 트레이딩 부적합
```

---

## 아키텍처

### 시스템 구조

```
┌─────────────────────────────────────────────────────────┐
│                   Paper Trading System                   │
│                    (trading_crew.py)                     │
└──────────────────────┬──────────────────────────────────┘
                       │
                       │ --strategy ai-sector
                       ▼
┌─────────────────────────────────────────────────────────┐
│            AI Sector Leader Selector                     │
│         (ai_sector_leader_strategy.py)                   │
│                                                           │
│  1. 업종별 종목 분류 (5대 업종)                         │
│  2. 종목별 종합 분석                                     │
│  3. 업종별 Top-N 선정                                    │
│  4. 블랙리스트 필터링                                    │
│  5. 비중 균등 배분                                       │
└──────┬────────────────┬────────────────┬────────────────┘
       │                │                │
       ▼                ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│    Volume    │ │  Financial   │ │  Exclusion   │
│   Analyzer   │ │   Analyzer   │ │   Manager    │
│              │ │              │ │              │
│ (volume_     │ │ (placeholder)│ │ (exclusion_  │
│  analysis.py)│ │              │ │  manager.py) │
└──────────────┘ └──────────────┘ └──────────────┘
```

### 핵심 모듈

#### 1. VolumeAnalyzer (`core/modules/volume_analysis.py`)

**기능**:
- 거래량/거래대금 분석
- 추세 판단 (급증/증가/유지/감소)
- 변동성 측정 (변동계수)
- 종합 점수 산출 (0-100점)

**주요 메서드**:
```python
def analyze_volume(stock_code: str, days: int = 60) -> Dict:
    """
    Returns:
        {
            'code': str,
            'avg_volume_20d': int,      # 20일 평균 거래량
            'avg_amount_20d': float,    # 20일 평균 거래대금 (원)
            'volume_trend': str,         # 추세 (급증/증가/유지/감소)
            'volume_change_pct': float,  # 변화율 (%)
            'volume_cv': float,          # 변동계수
            'recent_volume_surge': bool, # 최근 급증 여부
            'volume_score': float,       # 종합 점수 (0-100)
            'volume_rank': str          # 등급 (매우높음/높음/보통/낮음)
        }
    """
```

#### 2. AISectorLeaderSelector (`paper_trading/ai_sector_leader_strategy.py`)

**기능**:
- 업종별 종목 자동 분류
- 다차원 종합 분석
- 업종별 Top-N 선정
- 블랙리스트 필터링
- 투자 추천 생성

**주요 메서드**:
```python
def select_sector_leaders(
    market: str = "KOSPI",
    sectors: List[str] = None,
    leaders_per_sector: int = 1,
    min_volume_amount: float = 50_000_000_000  # 500억원
) -> List[Dict]:
    """
    Returns: [
        {
            'code': str,
            'name': str,
            'sector': str,
            'main_sector': str,
            'score': float,
            'weight': float,
            'volume_info': Dict,
            'reason': str
        },
        ...
    ]
    """
```

---

## 사용 방법

### 기본 실행

```bash
# 1. AI 기반 대장주 전략 실행 (분석만, DRY RUN)
python3 paper_trading/trading_crew.py --strategy ai-sector

# 2. 실제 매수 실행
python3 paper_trading/trading_crew.py --strategy ai-sector --execute
```

### 상세 옵션

```bash
python3 paper_trading/trading_crew.py \
    --strategy ai-sector \
    --account-id 1 \
    --market KOSPI \
    --cash-reserve 0.2 \
    --stop-loss -10.0 \
    --take-profit 20.0 \
    --execute \
    --save-log
```

**옵션 설명**:

| 옵션 | 기본값 | 설명 |
|------|--------|------|
| `--strategy` | ai | 전략 선택 (ai/sector/hybrid/**ai-sector**) |
| `--account-id` | 1 | 가상 계좌 ID |
| `--market` | KOSPI | 시장 선택 (KOSPI/KOSDAQ) |
| `--cash-reserve` | 0.2 | 현금 보유 비율 (20%) |
| `--stop-loss` | -10.0 | 손절 기준 (%) |
| `--take-profit` | 20.0 | 익절 기준 (%) |
| `--execute` | False | 실제 매수 실행 여부 |
| `--save-log` | False | 로그 파일 저장 여부 |

### 단독 실행 (테스트용)

```bash
# AI 기반 대장주 선정 시스템만 실행
python3 paper_trading/ai_sector_leader_strategy.py
```

**출력 예시**:
```
================================================================================
AI 기반 업종별 대장주 자동 선정
================================================================================

시장: KOSPI
업종당 선정: 1개
최소 거래대금: 500억원

[반도체/전기전자] 분석 중... (총 7개 종목)
--------------------------------------------------------------------------------
  ✓ LG에너지솔루션: 종합 70.0점 (거래량 70.0, 재무 70.0, 기술 70.0, 리스크 70.0)
  ✓ 삼성전자: 종합 69.4점 (거래량 68.0, 재무 70.0, 기술 70.0, 리스크 70.0)
  ✓ SK하이닉스: 종합 69.4점 (거래량 68.0, 재무 70.0, 기술 70.0, 리스크 70.0)
  ...

[반도체/전기전자] 최종 선정:
  🥇 1순위: LG에너지솔루션 (373220)
     종합 점수: 70.0점
     거래대금: 1330억원 (유지)
     세부: 거래량 70.0 | 재무 70.0 | 기술 70.0 | 리스크 70.0

...

================================================================================
✅ 총 5개 대장주 선정 완료
================================================================================

최종 추천 대장주:
  • LG에너지솔루션 (373220): 20.0% - 반도체/전기전자 대장주 (종합70점)
  • 기아 (000270): 20.0% - 자동차/운수장비 대장주 (종합68점)
  • LG화학 (051910): 20.0% - 화학 대장주 (종합68점)
  • KB금융 (105560): 20.0% - 금융 대장주 (종합68점)
  • NAVER (035420): 20.0% - IT/인터넷 대장주 (종합68점)
```

---

## 분석 알고리즘

### 전체 프로세스

```
1. 종목 수집
   ↓
2. 업종별 분류 (5대 업종)
   ↓
3. 거래량 분석 (최소 기준 필터)
   ↓
4. 다차원 종합 평가
   ├─ 거래량 점수 (30%)
   ├─ 재무 점수 (30%)
   ├─ 기술 점수 (20%)
   └─ 리스크 점수 (20%)
   ↓
5. 업종별 정렬 및 Top-N 선정
   ↓
6. 블랙리스트 필터링
   ↓
7. 비중 조정 (균등 배분)
   ↓
8. 투자 추천 생성
```

### 거래량 점수 계산 상세

```python
def calculate_volume_score(avg_amount, change_pct, cv, surge):
    score = 0

    # 1. 거래대금 점수 (0-50점)
    if avg_amount >= 200_000_000_000:    # 2,000억 이상
        score += 50
    elif avg_amount >= 100_000_000_000:  # 1,000억 이상
        score += 45
    elif avg_amount >= 50_000_000_000:   # 500억 이상
        score += 40
    elif avg_amount >= 30_000_000_000:   # 300억 이상
        score += 35
    elif avg_amount >= 10_000_000_000:   # 100억 이상
        score += 25
    else:
        score += 15

    # 2. 거래량 추세 점수 (0-30점)
    if change_pct >= 50:      # 급증 (50% 이상)
        score += 30
    elif change_pct >= 20:    # 증가 (20% 이상)
        score += 25
    elif change_pct >= -20:   # 유지 (±20%)
        score += 20
    else:                     # 감소
        score += 15

    # 3. 안정성 점수 (0-10점)
    if cv < 0.3:              # 안정적
        score += 10
    elif cv < 0.5:            # 보통
        score += 7
    else:                     # 불안정
        score += 5

    # 4. 최근 급증 보너스 (0-10점)
    if surge:
        score += 10

    return min(score, 100)
```

### 종합 점수 계산

```python
def calculate_综합_score(volume_score, financial_score, technical_score, risk_score):
    total_score = (
        volume_score * 0.30 +      # 거래량 30%
        financial_score * 0.30 +    # 재무 30%
        technical_score * 0.20 +    # 기술 20%
        risk_score * 0.20           # 리스크 20%
    )
    return round(total_score, 1)
```

---

## 실행 예시

### 예시 1: 기본 실행

```bash
$ python3 trading_crew.py --strategy ai-sector
```

**출력**:
```
================================================================================
📅 일일 자동 매매 워크플로 - 2025-10-25 11:24:06
================================================================================

[Step 1] 포트폴리오 업데이트
------------------------------------------------------------
✅ 0개 종목 업데이트 완료
   총 평가액: 0원

[Step 2] 손절/익절 체크
------------------------------------------------------------
✅ 손절/익절 대상 없음

[Step 3] 투자 분석 (전략: AI-SECTOR)
------------------------------------------------------------
AI 기반 대장주 전략 실행 (거래량 중심)

[반도체/전기전자] 분석 중... (총 7개 종목)
  ✓ LG에너지솔루션: 종합 70.0점
  ✓ 삼성전자: 종합 69.4점
  ✓ SK하이닉스: 종합 69.4점
  ...

📊 추천 종목 (5개):
   • 373220 (LG에너지솔루션): 20.0%
   • 000270 (기아): 20.0%
   • 051910 (LG화학): 20.0%
   • 105560 (KB금융): 20.0%
   • 035420 (NAVER): 20.0%

🔍 제외 종목 필터링 중...
✅ 최종 추천 종목 (5개): 제외 없음

[Step 4] 매수 실행
------------------------------------------------------------
ℹ️  [DRY RUN] 실제 매수 건너뜀

[Step 5] 일일 스냅샷 저장
------------------------------------------------------------
✅ 스냅샷 저장 완료
   총 자산: 10,000,000원
   수익률: +0.00%

================================================================================
✅ 일일 워크플로 완료
================================================================================
```

### 예시 2: 블랙리스트 적용

**사전 작업**:
```bash
# 카카오를 블랙리스트에 추가
python3 manage_exclusions.py add 035720 "높은 변동성"
```

**실행**:
```bash
$ python3 trading_crew.py --strategy ai-sector --execute
```

**출력 (IT/인터넷 섹터)**:
```
[IT/인터넷] 분석 중... (총 4개 종목)
--------------------------------------------------------------------------------
  ⚠️  카카오 (035720): 블랙리스트 제외
  ✓ NAVER: 종합 68.5점 (거래량 65.0, 재무 70.0, 기술 70.0, 리스크 70.0)

[IT/인터넷] 최종 선정:
  🥇 1순위: NAVER (035420)
     종합 점수: 68.5점
     거래대금: 5840억원 (유지)
```

### 예시 3: 거래대금 부족으로 제외

```
[금융] 분석 중... (총 5개 종목)
--------------------------------------------------------------------------------
  ✓ 신한지주: 종합 66.4점 (거래량 58.0, ...)
  ✓ KB금융: 종합 67.9점 (거래량 63.0, ...)
  ✓ 하나금융지주: 종합 66.4점 (거래량 58.0, ...)
  ❌ 메리츠금융지주: 거래대금 부족 (249억원)
  ❌ LG유플러스: 거래대금 부족 (401억원)

[금융] 최종 선정:
  🥇 1순위: KB금융 (105560)
```

---

## 설정 및 커스터마이징

### 거래대금 최소 기준 변경

**파일**: `paper_trading/trading_crew.py`

```python
# 기본값: 500억원
recommendations = get_ai_sector_leader_recommendations(
    market=market,
    num_sectors=5,
    leaders_per_sector=1,
    min_volume_amount=50_000_000_000  # ← 여기 수정
)

# 예시: 300억원으로 낮추기
min_volume_amount=30_000_000_000  # 300억원
```

### 업종당 선정 개수 변경

```python
# 기본값: 업종당 1개 (총 5개)
leaders_per_sector=1

# 업종당 2개로 변경 (총 10개)
leaders_per_sector=2
```

### 업종 선택

```python
# 전체 5개 업종
num_sectors=5

# 상위 3개 업종만
num_sectors=3
```

### 커스텀 업종 정의

**파일**: `paper_trading/ai_sector_leader_strategy.py`

```python
# 현재 정의된 5대 업종
MAIN_SECTORS = {
    "반도체/전기전자": ["반도체", "전자", "전기전자", "디스플레이"],
    "자동차/운수장비": ["자동차", "자동차부품", "운수장비", "조선"],
    "화학": ["화학", "정유", "플라스틱", "타이어"],
    "금융": ["은행", "증권", "보험", "금융"],
    "IT/인터넷": ["인터넷", "게임", "소프트웨어", "IT서비스", "통신서비스"]
}

# 업종 추가 또는 수정 가능
MAIN_SECTORS["헬스케어"] = ["제약", "바이오", "의료기기"]
```

### 가중치 조정

**파일**: `paper_trading/ai_sector_leader_strategy.py`

```python
# 현재 가중치
VOLUME_WEIGHT = 0.30      # 거래량 30%
FINANCIAL_WEIGHT = 0.30   # 재무 30%
TECHNICAL_WEIGHT = 0.20   # 기술 20%
RISK_WEIGHT = 0.20        # 리스크 20%

# 예시: 거래량 비중을 더 높이기
VOLUME_WEIGHT = 0.40      # 거래량 40%
FINANCIAL_WEIGHT = 0.30   # 재무 30%
TECHNICAL_WEIGHT = 0.15   # 기술 15%
RISK_WEIGHT = 0.15        # 리스크 15%
```

---

## FAQ

### Q1. 왜 거래량이 30%나 되나요?

**A**: 거래량은 다음과 같은 이유로 중요합니다:
- **유동성**: 매수/매도가 즉시 가능
- **시장 관심**: 많은 투자자들이 주목
- **모멘텀**: 거래량 증가는 상승 가능성 시사
- **리스크 관리**: 급락 시 빠른 손절 가능

사용자 요청: *"거래량. 사람들이 많이 사는 주식이 더 오를 가능성이 있습니다."*

### Q2. 재무/기술/리스크 점수가 모두 70점인 이유는?

**A**: 현재는 **프로토타입** 단계로 거래량 분석만 실제 구현되어 있습니다.

**추후 구현 예정**:
- 재무 점수: ROE, PER, PBR, 부채비율 등
- 기술 점수: 이동평균, RSI, MACD 등
- 리스크 점수: 변동성, MDD, 베타 등

현재는 거래량 분석을 검증하는 단계이며, 다른 지표들은 순차적으로 추가될 예정입니다.

### Q3. 어떻게 업종이 자동으로 분류되나요?

**A**: 데이터베이스의 `sector` 필드와 키워드 매칭:

```python
# 예시
종목: 삼성전자, sector: "반도체"
→ "반도체" 키워드 매칭
→ "반도체/전기전자" 업종으로 분류

종목: 현대차, sector: "자동차"
→ "자동차" 키워드 매칭
→ "자동차/운수장비" 업종으로 분류
```

### Q4. 거래대금 500억원 기준이 너무 높지 않나요?

**A**: 안정성을 위한 보수적 기준입니다:
- **KOSPI 대형주**: 대부분 500억원 이상
- **유동성 확보**: 급등락 시 신속 대응
- **슬리피지 최소화**: 원하는 가격에 체결

**조정 가능**:
```python
# 300억원으로 완화
min_volume_amount=30_000_000_000
```

### Q5. 블랙리스트는 어떻게 작동하나요?

**A**: 완전 자동 통합:
1. 사용자가 제외 종목 등록 (`manage_exclusions.py`)
2. AI 분석 시 자동으로 해당 종목 필터링
3. 로그에 제외 사유 표시
4. 비중 재조정 (남은 종목들로 100% 재분배)

**예시**:
```bash
# 카카오 제외 등록
python3 manage_exclusions.py add 035720 "높은 변동성"

# 다음 실행부터 자동 제외
python3 trading_crew.py --strategy ai-sector --execute
```

### Q6. AI 전략과 비교하면 어떤가요?

**A**: 각각 장단점이 있습니다:

| 항목 | AI 전략 | AI 기반 대장주 |
|------|---------|---------------|
| **안정성** | 중 | 높음 |
| **수익성** | 높음 (잠재적) | 중 |
| **유동성** | 중 | 매우 높음 |
| **이해도** | 복잡 | 단순 |
| **거래량** | 고려 안함 | 핵심 지표 |

**권장**: 하이브리드 전략 (50% AI + 50% AI 대장주)

### Q7. 매일 종목이 바뀌나요?

**A**: 아니요. 상대적으로 안정적입니다:
- 대형주 위주 → 순위 변동 적음
- 거래량 기준 → 급격한 변화 드뭄
- 업종별 1-2개 → 대표 종목은 고정적

**실제**: 월 1-2회 정도 변경 예상

### Q8. 섹터 로테이션은 고려하나요?

**A**: 현재는 **시장 중립적** 접근:
- 5개 업종 균등 배분 (각 20%)
- 경기 사이클 무관

**향후 개선**:
- 거시경제 지표 기반 업종 가중치 조정
- 섹터 로테이션 전략 추가

### Q9. 수익률 목표는?

**A**: 보수적 예상:
- **연 수익률**: KOSPI + 3-5%
- **변동성**: KOSPI와 유사 또는 약간 낮음
- **목표**: 시장 수익률 안정적 추종 + 알파

**장점**:
- 낮은 리스크
- 높은 유동성
- 심리적 안정감

### Q10. 실전 투자에 사용해도 되나요?

**A**: 신중한 접근 권장:

⚠️ **주의사항**:
1. 페이퍼 트레이딩으로 최소 3-6개월 검증
2. 소액으로 시작 (총 자산의 10-20%)
3. 손절 규칙 엄격 준수
4. 재무/기술/리스크 분석 추가 구현 후 사용

✅ **권장 단계**:
```
1단계: 페이퍼 트레이딩 (3개월)
2단계: 소액 실전 (6개월)
3단계: 본격 투자 (성과 확인 후)
```

---

## 관련 문서

- [EXCLUSION_GUIDE.md](EXCLUSION_GUIDE.md) - 블랙리스트 관리 가이드
- [SECTOR_STRATEGY_GUIDE.md](../paper_trading/SECTOR_STRATEGY_GUIDE.md) - 기존 대장주 전략 비교
- [paper_trading/README.md](../paper_trading/README.md) - 페이퍼 트레이딩 시스템

## 관련 파일

- **거래량 분석**: `core/modules/volume_analysis.py`
- **AI 선정기**: `paper_trading/ai_sector_leader_strategy.py`
- **통합 실행**: `paper_trading/trading_crew.py`
- **블랙리스트**: `core/utils/exclusion_manager.py`

---

## 면책 조항

```
본 시스템은 교육 및 연구 목적의 프로토타입입니다.

- 실제 투자 권유가 아닙니다
- 거래량 외 지표들은 아직 구현 중입니다 (재무/기술/리스크)
- 과거 성과가 미래 수익을 보장하지 않습니다
- 모든 투자 결정은 본인 책임입니다
- 충분한 검증 없이 실전 투자하지 마세요
```

---

**작성자**: Claude (AI Assistant)
**최종 업데이트**: 2025-10-25
**버전**: 1.0
**상태**: ✅ 프로토타입 완료 / 📋 추가 지표 개발 예정
